# 移动应用程序安全测试[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#mobile-application-security-testing)

在以下部分中，我们将简要概述一般安全测试原则和关键术语。介绍的概念与其他类型的渗透测试中的概念基本相同，因此如果您是一位经验丰富的测试人员，您可能会熟悉其中的一些内容。

在整个指南中，我们使用“移动应用程序安全测试”作为一个笼统的短语来指代通过静态和动态分析对移动应用程序安全性进行评估。“移动应用程序渗透测试”和“移动应用程序安全审查”等术语在安全行业中的使用有些不一致，但这些术语大致指的是同一件事。移动应用程序安全测试通常是更大的安全评估或渗透测试的一部分，包括移动应用程序使用的客户端-服务器架构和服务器端 API。

在本指南中，我们涵盖了两种情况下的移动应用程序安全测试。第一个是在开发生命周期接近尾声时完成的“经典”安全测试。在这种情况下，测试人员访问接近完成或生产就绪版本的应用程序，识别安全问题，并编写（通常是毁灭性的）报告。另一个上下文的特点是从软件开发生命周期开始就实现需求和安全测试的自动化。相同的基本要求和测试用例适用于这两种情况，但高级方法和客户端交互级别不同。

## 测试原理[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#principles-of-testing)

### 白盒测试与黑盒测试[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#white-box-testing-versus-black-box-testing)

让我们从定义概念开始：

- **黑盒测试**是在测试人员没有关于被测试应用程序的任何信息的情况下进行的。这个过程有时被称为“零知识测试”。此测试的主要目的是让测试人员在探索公开可用和可发现信息的可能用途方面表现得像真正的攻击者。
- **白盒测试**（有时称为“全知识测试”）与黑盒测试完全相反，因为测试人员对应用程序有充分的了解。知识可能包括源代码、文档和图表。这种方法允许比黑盒测试更快的测试，因为它是透明的，并且通过获得的额外知识，测试人员可以构建更复杂和更精细的测试用例。
- **灰盒测试**是介于上述两种测试类型之间的所有测试：一些信息提供给测试人员（通常仅凭据），而其他信息旨在被发现。这种类型的测试是测试用例数量、成本、速度和测试范围的有趣折衷。灰盒测试是安全行业中最常见的一种测试。

我们强烈建议您索取源代码，以便尽可能有效地利用测试时间。测试人员的代码访问显然不会模拟外部攻击，但它通过允许测试人员在代码级别验证每个已识别的异常或可疑行为来简化漏洞的识别。如果应用程序之前没有经过测试，则白盒测试是可行的方法。

尽管在 Android 上反编译很简单，但源代码可能会被混淆，反混淆会很耗时。因此，时间限制是测试人员访问源代码的另一个原因。

### 漏洞分析[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#vulnerability-analysis)

漏洞分析通常是在应用程序中寻找漏洞的过程。虽然这可以手动完成，但通常使用自动扫描器来识别主要漏洞。静态和动态分析是漏洞分析的类型。

### 静态与动态分析[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#static-versus-dynamic-analysis)

静态应用程序安全测试 (SAST) 涉及通过手动或自动分析源代码来检查应用程序的组件而不执行它们。OWASP 提供有关[静态代码分析](https://owasp.org/www-community/controls/Static_Code_Analysis)的信息，可以帮助您了解技术、优势、劣势和局限性。

动态应用程序安全测试 (DAST) 涉及在Runtime(运行时)检查应用程序。这种类型的分析可以是手动的或自动的。它通常不提供静态分析提供的信息，但它是从用户的角度检测有趣元素（资产、功能、入口点等）的好方法。

现在我们已经定义了静态和动态分析，让我们深入探讨一下。

### 静态分析[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#static-analysis)

在静态分析期间，审查移动应用程序的源代码以确保安全控制的适当实施。在大多数情况下，使用混合自动/手动方法。自动扫描抓住了容易实现的成果，人类测试人员可以在考虑特定使用上下文的情况下探索代码库。

#### 手动代码审查[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#manual-code-review)

测试人员通过手动分析移动应用程序的源代码以查找安全漏洞来执行手动代码审查。方法范围从通过“grep”命令的基本关键字搜索到源代码的逐行检查。IDE（集成开发环境）通常提供基本的代码审查功能，并且可以使用各种工具进行扩展。

手动代码分析的一种常见方法需要通过搜索某些 API 和关键字来识别关键安全漏洞指标，例如与数据库相关的方法调用，如“executeStatement”或“executeQuery”。包含这些字符串的代码是手动分析的良好起点。

与自动代码分析相比，手动代码审查非常适合识别业务逻辑中的漏洞、标准违规和设计缺陷，尤其是当代码在技术上是安全的但在逻辑上存在缺陷时。这种情况不太可能被任何自动代码分析工具检测到。

手动代码审查需要精通移动应用程序所用语言和框架的专家代码审查员。完整的代码审查对于审查者来说可能是一个缓慢、乏味、耗时的过程，尤其是在具有许多依赖项的大型代码库的情况下。

#### 自动化源代码分析[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#automated-source-code-analysis)

自动化分析工具可用于加快静态应用程序安全测试 (SAST) 的审查过程。他们检查源代码是否符合一组预定义的规则或行业最佳实践，然后通常会显示一份发现或警告列表，并标记所有检测到的违规行为。一些静态分析工具仅针对编译后的应用程序运行，一些必须提供原始源代码，还有一些在集成开发环境 (IDE) 中作为实时分析插件运行。

尽管一些静态代码分析工具包含了大量有关分析移动应用程序所需的规则和语义的信息，但它们可能会产生许多误报，尤其是在未针对目标环境进行配置的情况下。因此，安全专业人员必须始终检查结果。

[“测试工具”](https://mas.owasp.org/MASTG/Tools/0x08a-Testing-Tools/)一章包括静态分析工具列表，可以在本书末尾找到。

### 动态分析[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#dynamic-analysis)

DAST 的重点是通过实时执行对应用程序进行测试和评估。动态分析的主要目标是在程序Runtime(运行时)发现程序中的安全漏洞或弱点。动态分析在移动平台层和后端服务和 API 进行，可以分析移动应用程序的请求和响应模式。

动态分析通常用于检查安全机制是否提供了足够的保护来抵御最普遍的攻击类型，例如传输中的数据泄露、身份验证和授权问题以及服务器配置错误。

### 避免误报[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#avoiding-false-positives)

#### 自动扫描工具[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#automated-scanning-tools)

自动化测试工具对应用上下文缺乏敏感性是一个挑战。这些工具可能会识别一个无关紧要的潜在问题。这样的结果被称为“误报”。

例如，安全测试人员通常会报告可在 Web 浏览器中利用但与移动应用程序无关的漏洞。出现这种误报是因为用于扫描后端服务的自动化工具是基于常规的基于浏览器的 Web 应用程序。相应地报告了 CSRF（跨站点请求伪造）和跨站点脚本 (XSS) 等问题。

我们以 CSRF 为例。成功的 CSRF 攻击需要以下条件：

- 诱使登录用户在用于访问易受攻击站点的 Web 浏览器中打开恶意链接的能力。
- 客户端（浏览器）必须自动将会话 cookie 或其他身份验证令牌添加到请求中。

移动应用程序不满足这些要求：即使使用 WebView 和基于 cookie 的会话管理，用户单击的任何恶意链接都会在默认浏览器中打开，该浏览器具有单独的 cookie 存储。

如果应用程序包含 WebView，则存储跨站点脚本 (XSS) 可能会成为一个问题，如果应用程序导出 JavaScript 接口，它甚至可能导致命令执行。然而，由于上述原因，反映的跨站点脚本很少成为问题（尽管它们是否应该存在是有争议的，转义输出只是一种最佳实践）。

> 在任何情况下，执行风险评估时都要考虑漏洞利用场景；不要盲目相信扫描工具的输出。

### 渗透测试（又名Pentesting）[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#penetration-testing-aka-pentesting)

经典方法涉及对应用程序的最终或接近最终构建的全面安全测试，例如，在开发过程结束时可用的构建。对于开发过程结束时的测试，我们建议使用[移动应用程序安全验证标准 (MASVS)](https://github.com/OWASP/owasp-masvs)和相关的检查表作为测试基准。典型的安全测试结构如下：

- **准备**——定义安全测试的范围，包括识别适用的安全控制、组织的测试目标和敏感数据。更一般地说，准备包括与客户的所有同步以及合法保护测试人员（通常是第三方）。请记住，在世界许多地方，未经书面授权攻击系统是非法的！
- **情报收集**- 分析应用程序的**环境**和**架构**上下文以获得一般的上下文理解。
- **映射应用程序**——基于先前阶段的信息；可以通过自动扫描和手动浏览应用程序来补充。映射提供了对应用程序、它的入口点、它保存的数据以及主要潜在漏洞的透彻理解。然后可以根据这些漏洞的利用可能造成的损害对这些漏洞进行排序，以便安全测试人员可以确定它们的优先级。此阶段包括创建可在测试执行期间使用的测试用例。
- **利用**- 在此阶段，安全测试人员试图通过利用在前一阶段发现的漏洞来渗透应用程序。这个阶段对于确定漏洞是否是真实的和真正的肯定是必要的。
- **报告**——在这个对客户来说必不可少的阶段，安全测试人员报告漏洞。这包括详细的利用过程，对漏洞类型进行分类，记录攻击者能够破坏目标的风险，并概述测试人员能够非法访问的数据。

#### 准备[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#preparation)

必须在测试前确定要测试应用程序的安全级别。安全需求应该在项目开始时就确定下来。不同的组织有不同的安全需求和可用于测试活动投资的资源。尽管 MASVS 级别 1 (L1) 中的控件适用于所有移动应用程序，但与技术和业务利益相关者一起浏览 L1 和级别 2 (L2) MASVS 控件的整个清单是决定测试覆盖级别的好方法。

组织在某些地区可能有不同的监管和法律义务。即使应用程序不处理敏感数据，某些 L2 要求也可能相关（由于行业法规或当地法律）。例如，双因素身份验证 (2FA) 可能是金融应用程序的强制要求，并由国家的中央银行和/或金融监管机构强制执行。

在与利益相关者的讨论中，还可以审查在开发过程中较早定义的安全目标/控制。一些控件可能符合 MASVS 控件，但其他控件可能特定于组织或应用程序。

所有相关方必须就清单中的决定和范围达成一致，因为这些将定义所有安全测试的基线。

##### 与客户协调[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#coordinating-with-the-client)

设置工作测试环境可能是一项具有挑战性的任务。例如，对企业无线接入点和网络的限制可能会阻碍在客户端执行的动态分析。公司政策可能禁止在企业网络内使用有根电话或（硬件和软件）网络测试工具。实施Root检测和其他逆向工程对策的应用程序可能会显着增加进一步分析所需的工作量。

安全测试涉及许多侵入性任务，包括监控和操纵移动应用程序的网络流量、检查应用程序数据文件以及检测 API 调用。证书固定和Root检测等安全控制可能会阻碍这些任务并显着降低测试速度。

要克服这些障碍，您可能需要向开发团队请求应用程序的两个构建变体。一种变体应该是发布版本，以便您可以确定实施的控件是否正常工作并且不能轻易绕过。第二个变体应该是一个调试版本，其中某些安全控制已被停用。测试两个不同的构建是覆盖所有测试用例的最有效方法。

根据参与的范围，这种方法可能行不通。为白盒测试请求生产和调试版本将帮助您完成所有测试用例并清楚地说明应用程序的安全成熟度。客户可能更喜欢将黑盒测试集中在生产应用程序及其安全控制有效性的评估上。

应在准备阶段讨论这两种测试的范围。例如，是否应该调整安全控制应该在测试之前决定。下面讨论其他主题。

##### 识别敏感数据[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#identifying-sensitive-data)

敏感信息的分类因行业和国家/地区而异。此外，组织可能对敏感数据采取限制性观点，并且他们可能有明确定义敏感信息的数据分类策略。

可以从三种一般状态访问数据：

- **静态**- 数据位于文件或数据存储中
- **使用**中 - 应用程序已将数据加载到其地址空间
- **传输**中 - 数据已在移动应用程序和端点或设备上的消费进程之间交换，例如，在 IPC（进程间通信）期间

适合每个州的审查程度可能取决于数据的重要性和被访问的可能性。例如，应用程序内存中保存的数据可能比 Web 服务器上的数据更容易通过核心转储访问，因为攻击者更有可能获得对移动设备的物理访问权限，而不是对 Web 服务器的访问权限。

当没有可用的数据分类策略时，请使用以下通常被认为敏感的信息列表：

- 用户身份验证信息（凭证、PIN 等）
- 可用于身份盗用的个人身份信息 (PII)：社会安全号码、信用卡号码、银行帐号、健康信息
- 可以识别一个人的设备标识符
- 高度敏感的数据，其泄露会导致声誉损害和/或财务成本
- 其保护是一项法律义务的任何数据
- 由应用程序（或其相关系统）生成并用于保护其他数据或系统本身的任何技术数据（例如，加密密钥）

必须在测试开始之前确定“敏感数据”的定义，因为如果没有定义可能无法检测到敏感数据泄漏。

#### 情报收集[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#intelligence-gathering)

情报收集涉及收集有关应用程序架构、应用程序服务的业务用例以及应用程序运行环境的信息。此类信息可归类为“环境”或“建筑”。

##### 环境信息[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#environmental-information)

环境信息包括：

- 该组织的应用程序目标。功能塑造了用户与应用程序的交互，并可能使某些表面比其他表面更容易成为攻击者的目标。
- 相关行业。不同的行业可能有不同的风险状况。
- 利益相关者和投资者；了解谁对该应用程序感兴趣并对其负责。
- 内部流程、工作流和组织结构。特定于组织的内部流程和工作流可能会为[业务逻辑漏洞](https://owasp.org/www-community/vulnerabilities/Business_logic_vulnerability)创造机会。

##### 建筑信息[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#architectural-information)

架构信息包括：

- **移动应用程序：**应用程序如何访问数据并在进程中管理它，它如何与其他资源通信并管理用户会话，以及它是否检测到自己在越狱或获得 root 权限的手机上运行并对这些情况做出反应。
- **操作系统：**应用程序运行的操作系统和操作系统版本（包括 Android 或 iOS 版本限制），应用程序是否预期在具有移动设备管理 (MDM) 控件的设备上运行，以及相关的操作系统漏洞。
- **网络：**使用安全传输协议（例如 TLS）、使用强密钥和加密算法（例如 SHA-2）来保护网络流量加密、使用证书固定来验证端点等。
- **远程服务：**应用程序使用的远程服务以及它们被破坏是否会危及客户端。

#### 映射应用程序[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#mapping-the-application)

一旦安全测试人员获得有关应用程序及其上下文的信息，下一步就是映射应用程序的结构和内容，例如，识别其入口点、功能和数据。

当在白盒或灰盒范例中执行渗透测试时，项目内部的任何文档（架构图、功能规范、代码等）都可能极大地促进该过程。如果源代码可用，使用 SAST 工具可以揭示有关漏洞（例如，SQL 注入）的有价值信息。DAST 工具可能支持黑盒测试并自动扫描应用程序：测试人员需要数小时或数天，而扫描仪可能会在几分钟内完成相同的任务。然而，重要的是要记住，自动工具有局限性，只能找到它们被编程来寻找的东西。因此，可能需要人工分析来增强自动工具的结果（直觉通常是安全测试的关键）。

威胁建模是一个重要的工件：来自研讨会的文档通常极大地支持安全测试人员需要的大部分信息（入口点、资产、漏洞、严重性等）的识别。强烈建议测试人员与客户讨论此类文档的可用性。威胁建模应该是软件开发生命周期的关键部分。它通常发生在项目的早期阶段。

[OWASP 中定义](https://owasp.org/www-community/Threat_Modeling)的威胁建模指南通常适用于移动应用程序。

#### 开发[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#exploitation)

不幸的是，时间或财务限制将许多渗透测试限制在通过自动扫描仪进行应用程序映射（例如，用于漏洞分析）。尽管在前一阶段发现的漏洞可能很有趣，但必须从五个方面确认它们的相关性：

- **Damage** Potential——利用漏洞可能造成的损害
- **可重复性**——易于重现攻击
- **可利用**性——易于执行攻击
- **Affected users——**受攻击影响的用户数量
- **可发现**性——易于发现漏洞

尽管如此，一些漏洞可能无法利用，并可能导致轻微的妥协（如果有的话）。其他漏洞乍一看似乎无害，但在实际测试条件下被确定为非常危险。仔细经历开发阶段的测试人员通过描述漏洞及其影响来支持渗透测试。

#### 报告[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#reporting)

安全测试人员的调查结果只有在清楚地记录在案的情况下才会对客户有价值。一份好的渗透测试报告应包括但不限于以下信息：

- 执行摘要
- 范围和上下文的描述（例如，目标系统）
- 使用的方法
- 信息来源（由客户提供或在渗透测试中发现）
- 优先调查结果（例如，由 DREAD 分类构成的漏洞）
- 详细调查结果
- 修复每个缺陷的建议

网络上有很多渗透测试报告模板：谷歌是你的朋友！

## 安全测试和 SDLC[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#security-testing-and-the-sdlc)

尽管安全测试的原则在最近的历史中没有发Root本性的变化，但软件开发技术已经发生了巨大的变化。虽然敏捷实践的广泛采用正在加速软件开发，但安全测试人员必须变得更快、更敏捷，同时继续交付值得信赖的软件。

下一节将重点关注这一演变并描述当代安全测试。

### 软件开发生命周期中的安全测试[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#security-testing-during-the-software-development-life-cycle)

软件开发毕竟不是很古老，所以没有框架开发的结局很容易观察到。随着源代码的增长，我们都经历过需要一套最小的规则来控制工作。

过去，“瀑布”方法论被最广泛采用：开发按具有预定义顺序的步骤进行。仅限于单个步骤，回溯功能是瀑布方法的一个严重缺点。尽管它们具有重要的积极特征（提供结构、帮助测试人员明确需要努力的地方、清晰易懂等），但它们也有消极的特征（创建孤岛、缓慢、专业团队等）。

随着软件开发的成熟，竞争加剧，开发人员需要更快地对市场变化做出反应，同时以更小的预算创建软件产品。精简结构的想法开始流行，较小的团队开始合作，打破了整个组织的孤岛。“敏捷”概念诞生（Scrum、XP 和 RAD 是敏捷实施的著名示例）；它使更多的自主团队能够更快地协同工作。

安全最初并不是软件开发的一个组成部分。这是事后才想到的，由必须弥补软件安全性差的运营团队在网络级别执行！尽管当软件程序位于边界内时，未集成的安全性是可能的，但随着网络、移动和物联网技术出现新型软件消费，这一概念已经过时。如今，安全性必须**内置于**软件内部，因为补偿漏洞通常非常困难。

> 在下一节中，“SDLC”将与“安全 SDLC”互换使用，以帮助您内化安全是软件开发过程的一部分的想法。本着同样的精神，我们使用 DevSecOps 这个名称来强调安全是 DevOps 的一部分这一事实。

### 软件开发生命周期概述[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#sdlc-overview)

#### SDLC的一般描述[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#general-description-of-sdlc)

SDLC 总是由相同的步骤组成（整个过程在瀑布范式中是顺序的，在敏捷范式中是迭代的）：

- 对应用程序及其组件进行**风险评估，以确定其风险状况。**这些风险概况通常取决于组织的风险偏好和适用的监管要求。风险评估还基于多种因素，包括该应用程序是否可通过互联网访问以及该应用程序处理和存储的数据类型。必须考虑各种风险：金融、营销、工业等。数据分类政策规定了哪些数据是敏感数据以及必须如何保护这些数据。
- **安全需求**是在项目或开发周期开始时收集功能需求时确定的。创建用例时会添加**滥用案例。**如果需要，可以为团队（包括开发团队）提供安全培训（例如安全编码）。您可以使用[OWASP MASVS](https://mas.owasp.org/MASVS/)在风险评估阶段的基础上确定移动应用程序的安全要求。在添加特性和数据类时迭代地审查需求是很常见的，尤其是在敏捷项目中。
- **威胁建模**基本上是威胁的识别、枚举、优先级排序和初始处理，是必须在架构开发和设计过程中执行的基础工件。**安全架构**是一个威胁模型因素，可以在威胁建模阶段之后进行细化（针对软件和硬件方面）。**建立安全编码规则**并创建将使用的**安全工具**列表。明确了**安全测试**的策略。
- 所有安全要求和设计注意事项都应存储在应用程序生命周期管理 (ALM) 系统（也称为问题跟踪器）中，开发/运营团队使用该系统确保将安全要求紧密集成到开发工作流程中。安全要求应包含相关的源代码片段，以便开发人员可以快速引用这些片段。创建受版本控制且仅包含这些代码片段的专用存储库是一种安全的编码策略，比传统方法（将指南存储在 word 文档或 PDF 中）更有益。
- **安全地开发软件**。要提高代码安全性，您必须完成**安全代码审查**、**静态应用程序安全测试**和**安全单元测试**等活动。尽管存在这些安全活动的质量类似物，但必须将相同的逻辑应用于安全，例如，审查、分析和测试代码中的安全缺陷（例如，缺少输入验证、未能释放所有资源等）。
- 接下来是期待已久的发布候选测试：手动和自动**渗透测试**（“Pentests”）。**动态应用程序安全测试**通常也在此阶段执行。
- 在软件在所有利益相关者的**验收**期间获得**认可**后，它可以安全地转移到**运营**团队并投入生产。
- 经常被忽视的最后一个阶段是软件在使用结束后的安全**退役**。

下图说明了所有阶段和工件：

![img](https://mas.owasp.org/assets/Images/Chapters/0x04b/SDLCOverview.jpg)

根据项目的一般风险概况，您可能会简化（甚至跳过）一些工件，并且您可能会添加其他工件（正式的中介批准、某些点的正式文档等）。**永远记住两件事：SDLC 旨在降低与软件开发相关的风险，它是一个框架，可帮助您为此目的设置控制。**这是对 SDLC 的一般描述；始终根据您的项目定制此框架。

#### 定义测试策略[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#defining-a-test-strategy)

测试策略指定将在 SDLC 期间执行的测试以及测试频率。测试策略用于确保最终软件产品满足安全目标，这些目标通常由客户的法律/营销/企业团队确定。测试策略通常在安全设计阶段创建，在风险得到澄清之后（在启动阶段）和代码开发之前（安全实施阶段）开始。该策略需要来自风险管理、以前的威胁建模和安全工程等活动的输入。

测试策略不需要正式编写：它可以通过故事（在敏捷项目中）进行描述，在清单中快速列举，或者指定为给定工具的测试用例。但是，该策略肯定必须共享，因为它必须由定义它的团队以外的其他团队来实施。此外，所有技术团队都必须同意它，以确保它不会给他们中的任何一个带来不可接受的负担。

测试策略涉及以下主题：

- 目标和风险描述
- 实现目标的计划、降低风险、哪些测试将是强制性的、谁将执行这些测试、如何以及何时执行
- 验收标准

为跟踪测试策略的进度和有效性，应定义指标，在项目期间不断更新指标，并定期进行沟通。关于选择相关指标可以写一整本书；我们在这里最多只能说它们取决于风险状况、项目和组织。指标示例包括：

- 与已成功实施的安全控制相关的故事数量
- 安全控制和敏感功能单元测试的代码覆盖率
- 通过静态分析工具为每个构建发现的安全漏洞数量
- 安全错误积压的趋势（可能按紧急程度排序）

这些只是建议；其他指标可能与您的项目更相关。指标是控制项目的强大工具，前提是它们为项目经理提供了关于正在发生的事情和需要改进的事情的清晰和综合的观点。

区分内部团队执行的测试和独立第三方执行的测试很重要。内部测试通常对改善日常运营很有用，而第三方测试对整个组织更有好处。内部测试可以经常进行，但第三方测试每年最多进行一次或两次；而且，前者比后者便宜。两者都是必要的，许多法规要求独立第三方进行测试，因为这样的测试更值得信赖。

### 瀑布式安全测试[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#security-testing-in-waterfall)

#### 什么是瀑布以及如何安排测试活动[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#what-waterfall-is-and-how-testing-activities-are-arranged)

基本上，SDLC 不强制使用任何开发生命周期：可以肯定地说，在任何情况下都可以（而且必须！）解决安全问题。

瀑布方法在 21 世纪之前很流行。最著名的应用称为“V 模型”，其中阶段按顺序执行，您只能回溯一个步骤。该模型的测试活动按顺序发生并作为一个整体执行，主要在生命周期中大部分应用程序开发已完成的时刻执行。这种活动顺序意味着即使在发现缺陷后可能会更改代码，也几乎不可能更改在项目开始时设置的体系结构和其他因素。

### 敏捷/DevOps 和 DevSecOps 的安全测试[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#security-testing-for-agiledevops-and-devsecops)

DevOps 是指专注于软件开发（通常称为 Devs）和运营（通常称为 Ops）的所有利益相关者之间密切协作的实践。DevOps 不是合并 Devs 和 Ops。开发和运营团队最初在孤岛中工作，将开发的软件推向生产可能需要大量时间。当开发团队通过与敏捷合作将更多的交付转移到生产中时，运营团队必须加快步伐以适应步伐。DevOps 是应对这一挑战的解决方案的必要演变，因为它允许软件更快地发布给用户。这在很大程度上是通过广泛的构建自动化、测试和发布软件的过程以及基础架构更改（除了 DevOps 的协作方面）来实现的。

人们可能认为“DevOps”一词仅代表开发和运维团队之间的协作，然而，正如 DevOps 思想领袖 Gene Kim 所说：“乍一看，问题似乎只存在于开发和运维之间，但测试是在那里，你有信息安全目标，需要保护系统和数据。这些是管理层最关心的问题，它们已经成为 DevOps 的一部分。

换句话说，DevOps 协作包括质量团队、安全团队以及与项目相关的许多其他团队。当您今天听到“DevOps”时，您可能会想到[DevOpsQATestInfoSec](https://techbeacon.com/evolution-devops-new-thinking-gene-kim)之类的东西。事实上，DevOps 的价值不仅与提高速度有关，而且与提高质量、安全性、可靠性、稳定性和弹性有关。

安全性与应用程序的整体质量、性能和可用性一样对业务成功至关重要。随着开发周期的缩短和交付频率的增加，确保从一开始就内置质量和安全性变得至关重要。**DevSecOps**就是为 DevOps 流程增加安全性。大多数缺陷是在生产过程中发现的。DevOps 指定了在生命周期早期识别尽可能多的缺陷并最大限度地减少已发布应用程序中的缺陷数量的最佳实践。

然而，DevSecOps 不仅仅是一个线性过程，旨在为运营交付最好的软件；它还要求运营密切监视生产中的软件，以识别问题并通过与开发形成快速有效的反馈循环来解决问题。DevSecOps 是一个强调持续改进的过程。

![img](https://mas.owasp.org/assets/Images/Chapters/0x04b/DevSecOpsProcess.JPG)

这种强调的人性方面反映在跨职能团队的创建中，这些团队共同努力以实现业务成果。本节重点介绍必要的交互以及将安全性集成到开发生命周期（从项目开始到向用户交付价值结束）。

#### 什么是敏捷和 DevSecOps 以及如何安排测试活动[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#what-agile-and-devsecops-are-and-how-testing-activities-are-arranged)

##### 概述[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#overview)

自动化是 DevSecOps 的一项关键实践：如前所述，与传统方法相比，从开发到运营的交付频率增加了，并且通常需要时间的活动需要跟上，例如交付相同的附加值，同时花费更少的时间。因此必须放弃非生产性活动，必须完成重要任务。这些更改会影响基础架构更改、部署和安全性：

- 基础设施正在实施为**基础设施即代码**
- 部署变得越来越脚本化，通过**持续集成**和**持续交付的概念进行翻译**
- **安全活动**尽可能自动化，并贯穿整个生命周期

以下部分提供了有关这三点的更多详细信息。

##### 基础架构即代码[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#infrastructure-as-code)

基础架构即代码不是手动配置计算资源（物理服务器、虚拟机等）和修改配置文件，而是基于使用工具和自动化来加快配置过程并使其更加可靠和可重复。对应的脚本往往会保存在版本控制下，方便分享和解决问题。

基础设施即代码实践促进了开发和运营团队之间的协作，结果如下：

- 开发人员可以从熟悉的角度更好地理解基础架构，并可以准备运行应用程序所需的资源。
- Ops 运行一个更适合应用程序的环境，并且他们与 Devs 共享一种语言。

基础架构即代码还有助于构建经典软件创建项目所需的环境，用于**开发**（“DEV”）、**集成**（“INT”）、**测试**（“PPR”用于预生产。一些测试通常在早期环境中执行，并且 PPR 测试主要涉及非回归和性能，其数据类似于生产中使用的数据）和**生产**（“PRD”）。基础架构即代码的价值在于环境之间可能存在的相似性（它们应该是相同的）。

基础架构即代码通常用于具有基于云的资源的项目，因为许多供应商提供可用于供应项目（例如虚拟机、存储空间等）和处理配置（例如，修改内存大小或虚拟机使用的 CPU 数量）。这些 API 为管理员从监控控制台执行这些活动提供了替代方案。

该领域的主要工具有[Puppet](https://puppet.com/)、[Terraform](https://www.terraform.io/)、[Packer](https://www.packer.io/)、[Chef](https://www.chef.io/chef/)和[Ansible](https://www.ansible.com/)。

##### 部署[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#deployment)

部署管道的复杂程度取决于项目组织或开发团队的成熟度。在最简单的形式中，部署管道由一个提交阶段组成。提交阶段通常涉及运行简单的编译器检查和单元测试套件，以及创建应用程序的可部署工件。候选发布版是已签入版本控制系统主干的最新版本。发布候选者由部署管道评估是否符合他们必须满足的标准才能部署到生产环境。

提交阶段旨在为开发人员提供即时反馈，因此在每次提交到主干时运行。由于这个频率存在时间限制。提交阶段通常应在五分钟内完成，并且不应超过十分钟。就安全性而言，遵守这一时间限制非常具有挑战性，因为许多安全工具的运行速度不够快（#paul、#mcgraw）。

CI/CD 在某些上下文中表示“持续集成/持续交付”，在其他上下文中表示“持续集成/持续部署”。其实逻辑是：

- 持续集成构建操作（由提交触发或定期执行）使用所有源代码来构建候选版本。然后可以执行测试并检查发布是否符合安全、质量等规则。如果确认案例合规，则流程可以继续；否则，开发团队必须修复问题并提出更改建议。
- 持续交付候选版本可以进入预生产环境。如果随后可以验证发布（手动或自动），则可以继续部署。否则，将通知项目团队并采取适当的措施。
- 持续部署版本直接从集成过渡到生产，例如，它们变得可供用户访问。但是，如果在之前的活动中发现了重大缺陷，则不应将任何版本投入生产。

中低敏感度应用的交付部署可以合并为一个步骤，交付后进行验证。但是，强烈建议对敏感应用程序保持这两个操作分开并使用强验证。

##### 安全[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#security)

此时，最大的问题是：既然交付代码所需的其他活动已显着更快、更有效地完成，安全性如何跟上？我们如何才能保持适当的安全级别？在安全性降低的情况下更频繁地向用户交付价值肯定不是一件好事！

再一次，答案是自动化和工具：通过在整个项目生命周期中实施这两个概念，您可以维护和提高安全性。预期的安全级别越高，就会有越多的控制、检查点和重点。以下是示例：

- 静态应用程序安全测试可以在开发阶段进行，它可以集成到持续集成过程中，或多或少地强调扫描结果。您可以建立或多或少要求严格的安全编码规则，并使用 SAST 工具来检查其实施的有效性。
- 动态应用程序安全测试可以在应用程序构建之后（例如，在持续集成发生之后）和交付之前自动执行，同样，或多或少地强调结果。
- 您可以在连续的阶段之间添加手动验证检查点，例如，在交付和部署之间。

使用 DevOps 开发的应用程序在运营过程中必须考虑安全性。以下是示例：

- 扫描应该定期进行（在基础架构和应用程序级别）。
- 渗透测试可能会定期进行。（生产中使用的应用程序版本是应该进行渗透测试的版本，测试应在专用环境中进行，并包含与生产版本数据相似的数据。有关更多详细信息，请参阅渗透测试部分。）
- 应执行主动监控以识别问题并通过反馈回路尽快修复它们。

![img](https://mas.owasp.org/assets/Images/Chapters/0x04b/ExampleOfADevSecOpsProcess.jpg)

## 参考[¶](https://mas.owasp.org/MASTG/General/0x04b-Mobile-App-Security-Testing/#references)

- [保罗] - 保罗先生。CSSLP CBK 官方 (ISC)2 指南，第二版（(ISC)2 出版社），2014 年
- [麦格劳] - G 麦格劳。软件安全：构建安全性，2006 年
